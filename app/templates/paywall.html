{% extends "base.html" %} {% block title %}Payment Required - x402 Demo{%
endblock %} {% block content %}
<div class="row justify-content-center my-5">
  <div class="col-12 col-md-8 col-lg-6">
    <div class="card shadow-lg border-0">
      <div class="card-header bg-gradient-primary text-black py-4">
        <div class="d-flex align-items-center">
          <div class="display-4 me-3">ðŸ’Ž</div>
          <div>
            <h4 class="mb-0">Premium Access Required</h4>
            <small class="text-light-50"
              >Secure payment by crypto â€” fast & private</small
            >
          </div>
        </div>
      </div>

      <div class="card-body p-4">
        <!-- Network & Amount Info -->
        <div class="row g-3 mb-3">
          <div class="col-6">
            <div class="border rounded p-3 text-center">
              <small class="text-muted">Amount</small>
              <div class="fw-bold">{{ amount }} USDC</div>
            </div>
          </div>
          <div class="col-6">
            <div class="border rounded p-3 text-center">
              <small class="text-muted">Network</small>
              <div class="fw-bold" id="networkDisplay">
                {{ network_info.chain|upper|replace("-", " ") }}
              </div>
            </div>
          </div>
        </div>

        <!-- Wallet Connection Section -->
        <div id="walletSection" class="mb-3">
          <div class="d-grid">
            <button id="connectBtn" class="btn btn-warning btn-lg">
              ðŸ”Œ Connect MetaMask
            </button>
          </div>
        </div>

        <!-- Payment Section (Hidden Initially) -->
        <div id="paymentSection" style="display: none" class="mb-3">
          <div class="wallet-connected mb-3 p-3 bg-light rounded">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <small class="text-muted">Connected Wallet</small>
                <div id="walletAddress" class="fw-bold"></div>
              </div>
              <button
                id="disconnectBtn"
                class="btn btn-sm btn-outline-secondary"
              >
                Disconnect
              </button>
            </div>
          </div>

          <div class="d-grid mb-2">
            <button id="payBtn" class="btn btn-success btn-lg">
              ðŸ’° Pay {{ amount }} USDC
            </button>
          </div>
          <div class="text-muted small">
            âœ¨ Using x402 via 0xmeta - no gas fees, just sign authorization!
          </div>
        </div>

        <!-- Status Messages -->
        <div id="status" class="mt-3" aria-live="polite"></div>

        <!-- Success Section (Hidden Initially) -->
        <div id="successSection" style="display: none" class="mt-3">
          <div class="alert alert-success text-center">
            <h4 class="mb-1">âœ… Payment Authorized</h4>
            <p class="mb-2">
              Preparing your premium photos â€” redirecting shortly.
            </p>
            <div class="d-flex justify-content-center gap-2">
              <button id="viewNowBtn" class="btn btn-primary">View Now</button>
              <button id="stayBtn" class="btn btn-outline-secondary">
                Stay
              </button>
            </div>
            <p class="mt-2 text-muted small">
              Auto-redirect in <span id="countdown">3</span>sâ€¦
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<!-- Load Web3.js -->
<script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>

<!-- Load our app.js which handles hybrid payment logic -->
<!-- Using direct path since url_for has route ordering issues -->
<script src="/static/js/app.js"></script>
{% endblock %}
